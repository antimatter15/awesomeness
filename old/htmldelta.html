<div id="magic"></div>
<script>
var el = document.getElementById('magic');
var v1 = '<div>hello world</div><div class="_dyn" name="test1">BLAHBLAH</div><div>wheeeeeeeeeeeeeee</div>';
var v2 = '<div>hello poops</div><div class="_dyn" name="test1">EPIKPHAYLE</div><div>wheeeeeeeeeeeeeee</div>'

/*
	Idea:
		Iterate through special elements.
		Append to temporary container
		Replace parent HTML
		Iterate through special element references.
		Replace nodes with references to the real elements
	Dynamic Elements:
		Inline Replies
		Gadgets
*/

el.innerHTML = v1;

function change_dynamic(el, v2){
	var tmp = document.createElement('div');
	var name_map = {};
	for(var els = el.getElementsByClassName('_dyn'), l = els.length; l--;){
		name_map[els[l].getAttribute('name')] = els[l];
		tmp.appendChild(els[l]);
	
	}
	el.innerHTML = v2;
	for(var els = el.getElementsByClassName('_dyn'), l = els.length; l--;){
		els[l].parentNode.replaceChild(name_map[els[l].getAttribute('name')], els[l]);
	}
}


</script>